# SPDX-License-Identifier: MIT OR AGPL-3.0-or-later
# SPDX-FileCopyrightText: 2024-2025 hyperpolymath
#
# Nginx configuration for Docker well-known server

server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;

    # Security headers
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;

    location /.well-known/ {
        default_type text/plain;

        # JSON files
        location ~ \.json$ {
            default_type application/json;
        }

        # Apple App Site Association
        location = /.well-known/apple-app-site-association {
            default_type application/json;
        }

        # CORS for federation
        location ~ ^/.well-known/(webfinger|nodeinfo|matrix/) {
            add_header Access-Control-Allow-Origin "*";
        }
    }

    # Health check endpoint
    location = /health {
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }
}
